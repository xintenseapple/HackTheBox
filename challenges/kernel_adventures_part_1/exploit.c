#include <stdio.h>
#include <fcntl.h>
#include <stdlib.h>
#include <stdint.h>
#include <unistd.h>
#include <string.h>

struct user_entry {
    uint32_t uid;
    uint32_t password_hash;
} __attribute__((aligned(32)));

// value = 0x0, 0x0, 0x0, 0x0
uint32_t unhash(uint32_t hash) {
    return hash;
}

int main() {
    printf("Kernel Adventures Part 1 Exploitinator v1.1\n");

    int mysu_fd = open("/dev/mysu", O_RDWR);
    if (mysu_fd == -1) {
        printf("Failed to open '/dev/mysu'\n");
        exit(1);
    }

    struct user_entry users[4];
    memset(users, 0, sizeof(users));

    ssize_t count = read(mysu_fd, &users[0], sizeof(struct user_entry));

    if (count != sizeof(struct user_entry)) {
        printf("Failed to read '/dev/mysu'\n");
        exit(1);
    }
    else {
        printf("Successfully read '/dev/mysu'\n");
    }

    printf("User entries:\n");
    for (int i = 0; i < sizeof(users) / sizeof(struct user_entry); i++) {
        printf("%d %d\n", users[i].uid, users[i].password_hash);
    }

    //intermediate = (hash_value + (int)password[i]) * 0x401;
    //hash_value = intermediate ^ intermediate >> 6 ^ (int)password[i];

    return 0;
}
